let User;_78c‍.x([["default",()=>_78c‍.o]]);_78c‍.w("../models/user",[["default",["User"],function(v){User=v}]]);const jwt = require('../lib/jwt');
const secretKey = require('../lib/secretkey').secretKey;


const checkLoggedIn = async (ctx, next) => {
  const { token } = ctx.request.body;

  _78c‍.g.console.log('[TEST] Check LoggedIn : ', ctx.request.body);
  _78c‍.g.console.log('[TEST] Receive token : ', token);
  if (!token) {
    ctx.status = 401;
    console.log('token not exit');
    return;
  } else {
    try {
      // verify를 통해 값 decode
      const { _id } = await jwt.verify(token, secretKey);
      _78c‍.g.console.log('[TEST] _id : ', _id);

      // decoded_id를 DB에서 조회하여 사용자 find
      const ExistUser = await User.findById(_id);
      _78c‍.g.console.log('[TEST] Exist User : ', ExistUser);
      if (ExistUser) {
        ctx.state.user = ExistUser;
        return next();
      } else {
        ctx.status = 401;
      }
    } catch (err) {
      _78c‍.g.console.log(err);
      ctx.status = 401;
      return;
    }
  }
};

_78c‍.d(checkLoggedIn);
