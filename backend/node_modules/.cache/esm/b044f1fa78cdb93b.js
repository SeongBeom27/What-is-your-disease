let User,jwt;_78c‍.x([["update",()=>update]]);_78c‍.w("../../models/user",[["default",["User"],function(v){User=v}]]);_78c‍.w("../../lib/jwt",[["default",["jwt"],function(v){jwt=v}]]);


const secretKey = require('../../lib/secretkey').secretKey;

       const update = async (ctx) => {
  const { data, token } = ctx.request.body;
  // const { name, age, gender, bloodtype, allergy, medicines } = data;

  let _id, CurUser, NextUser;
  try {
    const decodedId = await jwt.verify(token, secretKey);
    _id = decodedId.id;
  } catch (err) {
    _78c‍.g.console.log(err);
  }
  _78c‍.g.console.log('[TEST] _id : ', _id);

  try {
    CurUser = await User.findById(_id);
    _78c‍.g.console.log('[TEST] CurUser : ', CurUser);
    if (!CurUser) {
      ctx.status = 404;
      return;
    }
  } catch (err) {
    ctx.throw(500, err);
  }

  // user 내용 update
  CurUser = { ...NextUser };
  CurUser.info = { ...data };

  try {
    const user = await User.findByIdAndUpdate(_id, CurUser, {
      new: true,
    }).exec();
    if (!user) {
      console.log('User Update fail');
      ctx.status = 404;
      return;
    }

    ctx.body = user;
  } catch (err) {
    ctx.throw(500, err);
  }
};
